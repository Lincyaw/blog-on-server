---
title: alpha-beta剪枝
date: 2020-10-09 16:02:25
tags: 
	- 算法
	- 人工智能
categories: 
	- 学习
mathjax: true
---

在人工智能课上的$\alpha-\beta$剪枝有一些疑惑， 故在网上查了资料， 做了总结。

<!--more-->

# 参考地址

[详解Minimax算法与α-β剪枝](https://blog.csdn.net/wenjianmuran/article/details/90633418)

[一图流解释 Alpha-Beta 剪枝(Alpha-Beta Pruning)](https://www.7forz.com/3211/)

网上解释$\alpha-\beta$剪枝的多为解释他的过程， 并没有解释为什么这样剪枝会比较合理。在之前做力扣动态规划的时候做到博弈dp类型的题目([877. 石子游戏](https://leetcode-cn.com/problems/stone-game/))时，看[题解](https://leetcode-cn.com/problems/stone-game/solution/ji-yi-hua-di-gui-dong-tai-gui-hua-shu-xue-jie-java/)也是一知半解。

今天将这个题目的场景代入到$\alpha-\beta$剪枝当中， 希望能够加深对于这个剪枝方法的理解。



# 博弈概念描述

这里讨论的是双人完备信息博弈问题。双人完备信息博弈指的是两位选手对垒，轮流走步，没放不仅知道对方已经走过的棋布，还能估计出对方未来的走步。如象棋、围棋等。

在这种博弈时，双方都希望自己能够获胜，因此当任何一方走步时，都是选择对自己最有利而对对方最比例的行动方案。设博弈的一方为MAX，另一方为MIN。在博弈的过程中可供MAX和MIN选择的行动方案可能有多种。从MAX方的观点看，可供自己选择的那些行动方案是**“或”**的关系，因为主动权掌握在MAX手里，选择哪个方案完全是由自己决定的；而可供对方选择的行动方案之间是**“与”**的关系，因为主动权掌握在MIN的手里，任何一个方案都可能被MIN选中，MAX必须防止那种对自己最为不利的情况发生。

## 博弈树

  若把双人完备信息博弈过程用图表示出来，就得到一棵与/或树，这种与/ 或树被称为博弈树。在博弈树中，那些下一步该MAX走步的节点称为**MAX 节点**，下一步该MIN走步的节点称为**MIN 节点**。

博弈树的特点

​	(1) 博弈的初始状态是初始节点；

​	(2) 博弈树中的“或”节点和“与”节点是逐层交替出现的；

​	(3) 整个博弈过程始终站在某一方的立场上，例如MAX方。所有能使自己一方获胜的终局都是本原问题，相应的节点是可解节点；所有使对方获胜的终局都是不可解节点。 



## 极大极小过程

对于复杂的博弈问题，不可能生成整个搜索树，如国际象棋，大约有$10^{120}$个节点。一种可行的方法是用当前正在考察的节点生成一棵部分博弈树，并利用估价函数f(n)对叶节点进行静态估值。

- 对叶节点的估值方法是： 
  - 那些对MAX有利的节点，其估价函数取正值； 
  - 那些对MIN有利的节点，其估价函数取负值； 
  - 那些使双方均等的节点，其估价函数取接近于0的值。

- 为非叶节点的值，必须从叶节点开始向上倒退。 其倒退方法是：
  - 对于MAX节点，由于MAX 方总是选择估值最大的走步，因此， MAX节点的倒推值应该**取其后继节点估值的最大值。**
  - 对于MIN节点，由于MIN方总是选择使估值最小的走步，因此MIN 节点的倒推值应**取其后继节点估值的最小值**。

## 为什么剪枝

![ppt图](https://lincyaw.xyz/blogimg/boyi.png)

令$e(+p)$为可能令x三字成线的数目，$e(-p)$为可能令o三字成线的数目

令$e(p)=e(+p)-e(-p)$， 表示估价函数。很明显，对于MAX这方来说$e(p)$越大越好，对MIN来说$e(p)$越小越好。

上图表示的是在一字棋开局的时候，MAX选择自己要下的子的位置。刚开局时MAX有三种选择($S_1，S_2，S_3$)，为了知道这三种选择哪个好，就要继续向下搜索。

第二层是MIN选择，对于MAX刚刚选出来的3中选择，MIN有12种选择。因此可以计算出MIN走步之后的启发式函数的值。如最左边的$6-5=1$，即表示MAX可以有6种可能三点一线，而MIN只有5种。同理，其余的11种都可以以此计算。

上面说了，MAX选择是“或”的关系，MIN的选择对于MAX来说是“与”的关系，对于MIN自己来说也是“或”的关系。因为$S_1$是轮到MIN选择，MIN一定会选择$e(p)$最小的那个，即-1。同理，后面的$S_2，S_3$也是找他子节点中最小的那个。

现在自下而上返回$S_0$结点。MAX在下棋时推导了2步，思考了自己在下了一步棋之后，MIN下棋会导致自己的局势变好还是变差。根据上面求出来的值，他发现$S_3$是最好的，相比于其他两种方式可能会让MIN造成对自己不利的局面，$S_3$可以保证自己占领优势。因此， $S_0$等于他的子节点中最大的那个值， 表示自己选择那一步。

那么为什么要剪枝呢？

有两种情况：

1. MAX在搜索的过程中，已经搜索完了一条路径，知道了走那条路径自己至少可以有2的收益；而在搜索这条路的过程中，出现了自己只能收益1的路径。那么这条路径就可以结束搜索了，因为不论后面有没有比2更高的路径，比如有收益1000的路径，但是MIN结点是不会让自己选那一条的，MIN一定会让MAX选择收益最小的那条路径，比如是1；亦或者有比1更小的收益，比如-1，-2...，很明显，这些结果对于MAX来说是比不上另一条路径的。
2. MIN在搜索的过程中，也已经搜索完了一条路径，例如上面的使MAX收益为1的路径，而在搜索下一条路径$\Gamma$的时候发现了可能让MAX收益为1000的路径$\sigma$，(很明显，$\sigma$是$\Gamma$的子路径)，那么$\Gamma$后续的子路径就不需要搜索了，理由同上。

## 剪枝的概念 

在极大极小搜索过程中，剪去一些没用的分枝，减少了搜索空间，使得算法在同样时间内可以搜索更深层，这种技术被称为α-β剪枝。 剪枝方法:

​	(1) MAX节点（或节点）的α值为当前子节点的**最大倒推值**； 

​	(2) MIN节点（与节点）的β值为当前子节点的**最小倒推值**；

​	(3) α-β剪枝的规则如下：

​			**β剪枝:**  任何MAX节点n的**α值**大于或等于它**先辈节点的β值**，则n 以下的分枝可停止搜索，并令节点n的倒推值为α。这种剪枝称为β剪枝。

​			**α剪枝:**  任何MIN节点n的**β值**小于或等于它**先辈节点的α值**，则n 以下的分枝可停止搜索，并令节点n的倒推值为**β**。这种剪枝称为α剪枝。

# 场景描述

![ppt图](https://lincyaw.xyz/blogimg/boyi0.png)

小圆和小方两个人每次可以拿一堆石子， 如上图中的12堆石子; 每一堆的石子数量不一样;

小圆和小方的目的就是让对方拿的石子数量越少越好， 让自己拿个数量越多越好。



在概念中对$\alpha$的定义是MAX节点（或节点）的α值为当前子节点的最大倒推值;

在这个场景中我认为就是小方在**选择最理想的石堆的情况下，** 能拿到的**最多**的石子数量。

并且$\alpha$应该越大越好， 这样小方越有可能获胜。



如下图中，在点B时，是小方选择；先不看上面标注的$\alpha \beta$，自己考虑一下在这种情况下小方能够拿到的石子数量最多是最少呢？

![ppt图](https://lincyaw.xyz/blogimg/boyi1.png)

很显然，小方应该走左边的路径； 因为小圆一定是会让小方拿到的石子数越少越好，因此结点3的子节点中**最小的数**就是小方能够拿到的**最大的石子数**；同理，如果走右边的路，结点C中的最小的数就是小方能拿到的最大的数：2；

$3>2$， 所以小方应该走左边的路应该拿的东西。



# 解释剪枝

在[定义](#剪枝的概念)中他们说$\alpha$是**最大倒推值**， 但是倒推值到底是什么呢?

我认为: **倒推值就是任意一名玩家， 在这个位置上能够得到的最大收益**

$\alpha$， 最大倒推值， 就是让**小方**在这个位置上的最大收益; 

$\beta$， 最小倒推值， 就是让**小圆**在这个位置上的最大收益， 也就是让小方能得到的收益最小



如下图中的正方形和圆形里都有一个数字， 即为倒推值; 在这个圆形或者正方形边上有$\alpha$和$\beta$

![](https://lincyaw.xyz/blogimg/boyi2.png)

因为整个博弈**过程始终站在某一方的立场上**， 这里始终站在小方的立场上， 所以在小方做选择的时候更新$\alpha$， 小圆做选择的时候更新$\beta$，  也就是每一层只更新一个符号。

那么，减掉左下方的那个12的那条路径的原因就是：

​	搜到2的时候， 在另一条路上小方已经能拿到３的石子了（$\alpha$），而在这条路上竟然还有比3还小的? 那我走这条路， 小圆铁定让我只能拿2啊， 那还不如走另一条路呢!

>  即 **α剪枝:**  
> 任何MIN节点n的**β值**(小圆能让小方拿的石子数， 他的子节点中最小的倒推值:2 )小于或等于它**先辈节点的α值**(小方走其他路能拿的石子数:3， 先辈结点的其他子节点中最大的倒推值:3)，则n 以下的分枝可停止搜索，并令节点n的倒推值为**β**(小圆就直接会选择2， 所以小方走这条路能获得收益就是2)。



删掉第二个X的原因为$\beta$剪枝

> 任何MAX节点n的**α值**(15)大于或等于它**先辈节点的β(3)值**，则n 以下的分枝可停止搜索，并令节点n的倒推值为α。这种剪枝称为β剪枝。

即， 小圆已经有一条路能够让小方获益3块石头了， 走这条路竟然能让小方有可能获益15块石头， 这能忍吗? 





其他的剪枝也是这个道理， 具体过程可以参考[这篇文章](https://blog.csdn.net/wenjianmuran/article/details/90633418)， 已经非常详细了。